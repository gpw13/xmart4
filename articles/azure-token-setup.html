<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="xmart4">
<title>Token setup in R • xmart4</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Token setup in R">
<meta property="og:description" content="xmart4">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">xmart4</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/azure-client-setup.html">xMart4 Azure Client Setup</a>
    <a class="dropdown-item" href="../articles/azure-token-setup.html">Token setup in R</a>
    <a class="dropdown-item" href="../articles/azure-wims-setup.html">Azure WIMS Setup</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/gpw13/xmart4/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Token setup in R</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/gpw13/xmart4/blob/HEAD/vignettes/azure-token-setup.Rmd" class="external-link"><code>vignettes/azure-token-setup.Rmd</code></a></small>
      <div class="d-none name"><code>azure-token-setup.Rmd</code></div>
    </div>

    
    
<p>Most of the work in getting access to the xMart4 API using an authenticated Azure client has to be done outside of R. This primarily consists of setting up a client application in WHO AzureAD and supplying that client’s ID and secret to the xMart4 API. Once your client has access to the xMart4 API, mart permissions can be managed by the admin of each mart individually. Full details on this process can be found in the Azure client setup vignette:</p>
<ul>
<li><code><a href="../articles/azure-client-setup.html">vignette("azure-client-setup", package = "xmart4")</a></code></li>
</ul>
<p>This package works to streamline the process on the R side by making access to xMart4 as simple as possible. If the client configuration is properly done, then this package allows you full access to xMart4 by only editing your <code>.Renviron</code> file once. Add your <code>remoteClientID</code> and <code>remoteClientSecret</code> from WHO AzureAD to that by running <code>usethis::edit_r_environ()</code> and adding these two lines (replacing hashes with actual client ID and secret values):</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">XMART_REMOTE_CLIENT_ID</span> <span class="op">=</span> <span class="st">"############"</span>
<span class="va">XMART_REMOTE_CLIENT_SECRET</span> <span class="op">=</span> <span class="st">"############"</span></code></pre></div>
<p>Save the file and restart your R session. You will now be able to access all xMart4 marts your client app has been granted permission to access by mart admins. Unless your client changes, you should not have to run this setup ever again and tokens will be managed in the background for you by the <code>xmart4</code> package.</p>
<div class="section level2">
<h2 id="underlying-functionality">Underlying functionality<a class="anchor" aria-label="anchor" href="#underlying-functionality"></a>
</h2>
<p>So how does this work in practice? The first time you call the <code><a href="../reference/xmart4_api.html">xmart4_api()</a></code> in a session (either directly or by using any function to access marts or tables), if a token is not manually provided, a token will be automatically generated. <code>get_xmart_token()</code> will be run to get an access token for either the xMart4 UAT or PROD server, depending on the API call. This will then be stored in the package environment, <code>xmart4:::.xmart_env</code>.</p>
<p>Every subsequent time an API call is made, that environment is searched for the correct token (UAT or PROD), and if the token doesn’t exist or has expired, a new token will be generated. All of this should never require you to directly request a token or manage token access. Separate tokens are managed for both UAT and PROD servers simultaneously.</p>
<p>Once setup, in every session, you can just directly start requesting access to marts and tables with <code>xmart4</code> functions, without having to specify the token</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/xmart4_mart.html">xmart4_mart</a></span><span class="op">(</span><span class="va">...</span>, token <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="co"># don't actually need to specify token = NULL, it's the default</span>
<span class="fu"><a href="../reference/xmart4_table.html">xmart4_table</a></span><span class="op">(</span><span class="va">...</span>, token <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="directly-managing-token-access">Directly managing token access<a class="anchor" aria-label="anchor" href="#directly-managing-token-access"></a>
</h2>
<p>The only instance where you might want to personally manage token access would be if you’re attempting to access the xMart4 API through multiple clients. You could still let your primary client defined in your <code>.Renviron</code> run automatically, by calling the xMart4 API without specifying the token.</p>
<p>For additional clients not setup this way, you can just directly request your tokens. For instance, to set up and use a new access token for the UAT server:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">token_uat_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/xmart4_token.html">xmart4_token</a></span><span class="op">(</span>client_id <span class="op">=</span> <span class="st">"#######"</span>,
                            client_secret <span class="op">=</span> <span class="st">"#######"</span>,
                            xmart_server <span class="op">=</span> <span class="st">"UAT"</span><span class="op">)</span>

<span class="fu"><a href="../reference/xmart4_mart.html">xmart4_mart</a></span><span class="op">(</span><span class="va">...</span>, token <span class="op">=</span> <span class="va">token_uat_2</span><span class="op">)</span>
<span class="fu"><a href="../reference/xmart4_table.html">xmart4_table</a></span><span class="op">(</span><span class="va">...</span>, token <span class="op">=</span> <span class="va">token_uat_2</span><span class="op">)</span></code></pre></div>
<p>You can check the time left on your token using <code>xmart_token_time(token_uat_2)</code> (they come with 60 minutes of validity once generated). Hopefully you don’t need to manually manage your tokens, but these wrappers should still make the process as painless as possible as xmart4 streamlines the POST requests and expiry checks.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Seth Caldwell.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
